{  
  "AWSTemplateFormatVersion":"2010-09-09",
  "Metadata":{  
    "AWS::CloudFormation::Designer":{  
      "f9c8436c-7500-4753-ab2a-e40ac178021f":{  
        "size":{  
          "width":60,
          "height":60
        },
        "position":{  
          "x":110,
          "y":410
        },
        "z":0,
        "embeds":[  

        ]
      },
      "c9f10ed0-54c3-48f6-b01f-8a41c39aa21d":{  
        "size":{  
          "width":60,
          "height":60
        },
        "position":{  
          "x":260,
          "y":410
        },
        "z":0,
        "embeds":[  

        ]
      },
      "a5098308-7362-40c5-adb9-de4c318b4224":{  
        "size":{  
          "width":60,
          "height":60
        },
        "position":{  
          "x":108.5,
          "y":507
        },
        "z":0,
        "embeds":[  

        ]
      }
    }
  },
  "Parameters":{  
    "LexBotName":{  
      "Type":"String",
      "Description":"The name of the Lex Bot",
      "Default":"SampleBot",
      "MinLength":2,
      "MaxLength":50,
      "AllowedPattern":"^[a-zA-Z_]+$",
      "ConstraintDescription":"Lex Bot name can only contain alphabetical and underscore characters, no spaces are allowed."
    }
  },
  "Resources":{  
    "LexBotLambda":{  
      "Type":"AWS::Lambda::Function",
      "Properties":{  
        "Code":{  
          "S3Bucket":"chatbot-cloudformation",
          "S3Key":"createLexBot.zip"
        },
        "Handler":"index.handler",
        "Runtime":"nodejs6.10",
        "Timeout":30,
        "Role":{  
          "Fn::GetAtt":[  
            "LexBotLambdaRole",
            "Arn"
          ]
        }
      },
      "DependsOn":[  
        "LexBotLambdaRole"
      ],
      "Metadata":{  
        "AWS::CloudFormation::Designer":{  
          "id":"f9c8436c-7500-4753-ab2a-e40ac178021f"
        }
      }
    },
    "LexBotLambdaRole":{  
      "Type":"AWS::IAM::Role",
      "Properties":{  
        "AssumeRolePolicyDocument":{  
          "Version":"2012-10-17",
          "Statement":[  
            {  
              "Effect":"Allow",
              "Principal":{  
                "Service":[  
                  "lambda.amazonaws.com"
                ]
              },
              "Action":[  
                "sts:AssumeRole"
              ]
            }
          ]
        },
        "Policies":[  
          {  
            "PolicyName":"LexBotLambdaPolicy",
            "PolicyDocument":{  
              "Version":"2012-10-17",
              "Statement":[  
                {  
                  "Effect":"Allow",
                  "Action":[  
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Resource":"arn:aws:logs:*:*:*"
                },
                {  
                  "Effect":"Allow",
                  "Action":[  
                    "lex:*"
                  ],
                  "Resource":"*"
                }
              ]
            }
          }
        ]
      },
      "Metadata":{  
        "AWS::CloudFormation::Designer":{  
          "id":"c9f10ed0-54c3-48f6-b01f-8a41c39aa21d"
        }
      }
    },
    "LexBot":{  
      "Type":"Custom::LexBot",
      "Properties":{  
        "ServiceToken":{  
          "Fn::GetAtt":[  
            "LexBotLambda",
            "Arn"
          ]
        },
        "LexBotName":{  
          "Ref":"LexBotName"
        }
      },
      "DependsOn":[  
        "LexBotLambda"
      ],
      "Metadata":{  
        "AWS::CloudFormation::Designer":{  
          "id":"a5098308-7362-40c5-adb9-de4c318b4224"
        }
      }
    }
  },
  "Outputs":{  
    "LexBotName":{  
      "Description":"Lex Bot name",
      "Value":{  
        "Fn::GetAtt":[  
          "LexBot",
          "FinalLexBotName"
        ]
      }
    }
  }
}